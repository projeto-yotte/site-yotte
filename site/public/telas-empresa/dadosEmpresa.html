<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/global.css">
    <link rel="stylesheet" href="../css/x.css">
    <link rel="stylesheet" href="../css/area_controle.css">
    <link rel="icon" href="../assets/img/favicon.png">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="../js/cadastroADM.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <link rel="stylesheet" href="../css/visaoGeral.css">
    <link rel="stylesheet" href="../css/dadosEmpresa.css">
    <title>Dados da empresa</title>
</head>
<style>

</style>

<body>
    <div class="tudao">
        <div class="menu">
            <div class="header">
                <div class="caixa_img">
                    <img class="logo" src="../assets/img/logo-navbar.png" alt="">
                </div>
            </div>
            <div class="caixa-esquerda">
                <div class="esquerda">
                    <button class="botao-menu" onclick="window.location = 'area_controle.html'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-person-add" viewBox="0 0 16 16">
                            <path
                                d="M12.5 16a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Zm.5-5v1h1a.5.5 0 0 1 0 1h-1v1a.5.5 0 0 1-1 0v-1h-1a.5.5 0 0 1 0-1h1v-1a.5.5 0 0 1 1 0Zm-2-6a3 3 0 1 1-6 0 3 3 0 0 1 6 0ZM8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" />
                            <path
                                d="M8.256 14a4.474 4.474 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10c.26 0 .507.009.74.025.226-.341.496-.65.804-.918C9.077 9.038 8.564 9 8 9c-5 0-6 3-6 4s1 1 1 1h5.256Z" />
                        </svg>
                        Cadastrar novo Admin
                    </button> <br> <br>
                    <button class="botao-menu">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-person" viewBox="0 0 16 16">
                            <path
                                d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z" />
                        </svg>
                        Editar dados da Empresa
                    </button> <br> <br>
                    <button class="botao-menu" onclick="encerrarSession()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z" />
                            <path fill-rule="evenodd"
                                d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z" />
                        </svg>
                        Sair
                    </button>
                </div>
            </div>
        </div>
        <div class="direita">
            <div class="tittleEmpresaDados">
                <h1>Dados da empresa</h1>
            </div>

            <div class="campos_input">
                Nome: <input type="text" id="input_nome" class="inputDados"> <br>
                Nome fantasia:<input type="text" id="input_nomeFantasia" class="inputDados"><br>
                CNPJ: <input type="text" id="input_cnpj" class="inputDados"><br>
                Email: <input type="text" id="input_email" class="inputDados"><br>
                Senha: <input type="password" id="input_senha" disabled> <br>
            </div>

            <div id="caixa_button">
                <button onclick="ativarInput()" class="button_tela">Editar</button>
                <button onclick="butaoAdm()" class="button_tela">Trocar Senha</button>
            </div>
        </div>


        <dialog id="modal-add-adm" close>
            <div class="corpo">
                <div class="container-modal">
                    <div class="back">
                        <a id="FecharModal">
                            <span id="FecharModal">
                                ↤
                            </span>
                        </a>
                    </div>
                    <div class="top-logo">
                        <img class="logo" src="../assets/img/logoCopia.png" alt="">
                    </div>
                    <div class="info-input">

                        <div>
                            <input id="input_senhaEmpresa" class="input" placeholder="Nova senha" type="password">
                        </div>

                        <div>
                            <input id="input_confirmarSenhaEmpresa" class="input" placeholder="Confirmar senha"
                                type="password">
                        </div>
                        <div class="eye">
                            <i class="bi bi-eye-fill" onclick="mostrarOcultarSenha()" id="mostrarSenha"></i>
                        </div>
                    </div>
                    <div class="button-logar">
                        <button onclick="editarSenha()" class="button-login">
                            Alterar senha
                        </button>
                    </div>
                </div>
            </div>
        </dialog>

    </div>


</body>

</html>

<script>
    function ativarInput() {
        for (var i = 0; i < inputs.length; i++) {
            inputs[i].style.border = "#000000 solid 1px";
            inputs[i].disabled = false;
            inputs[i].style.backgroundColor = "#ffffff"
            console.log(inputs[i].value); // seleciona todas as input com a class do inputs
        }

        div_Dados.innerHTML = "<button onclick='editarDados()'>Salvar </button>"
    }

    function editarSenha() {
        var senhaEmpresa = input_senhaEmpresa.value;
        var confirmar = input_confirmarSenhaEmpresa.value;
        if (senhaEmpresa == confirmar) {
            fetch(`../empresa/editarSenhaEmpresa/${sessionStorage.getItem("ID_EMPRESA")}`, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({

                    novaSenhaServer: senhaEmpresa,


                })
            }).then(function (resposta) {

                if (resposta.ok) {
                    window.location = 'dadosEmpresa.html';

                } else if (resposta.status == 404) {
                    window.alert("Deu 404!");
                } else {
                    throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });
        } else {
            window.alert("Senha não coincidem")
        }


    }

    function editarDados() {
        fetch(`../empresa/editarEmpresa/${sessionStorage.getItem("ID_EMPRESA")}`, {
            method: "PUT",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({

                nomeEmpresaServer: input_nome.value,
                nomeFantasiaServer: input_nomeFantasia.value,
                cpnjServer: input_cnpj.value,
                emailServer: input_email.value

            })
        }).then(function (resposta) {

            if (resposta.ok) {
                window.location = 'dadosEmpresa.html';

            } else if (resposta.status == 404) {
                window.alert("Deu 404!");
            } else {
                throw ("Houve um erro ao tentar realizar a postagem! Código da resposta: " + resposta.status);
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });
    }

    fetch(`../empresa/dadosDaEmpresa/${sessionStorage.getItem("ID_EMPRESA")}`).then(function (resposta) {
        if (resposta.ok) {

            if (resposta.status == 204) {
                alert("Nenhum resultado encontrado.");
            }

            resposta.json().then(function (resposta) {
                console.log("Dados recebidos: ", JSON.stringify(resposta));
                console.log(resposta);

                var empresa = resposta[0];

                if (resposta.nome != "") {
                    input_nome.value = empresa.nome;
                }
                input_nomeFantasia.value = empresa.nome_fantasia;

                input_cnpj.value = empresa.cnpj;

                input_email.value = empresa.email;

                input_senha.value = "**************";


                inputs = document.getElementsByClassName(`inputDados`);

                for (var i = 0; i < inputs.length; i++) {
                    inputs[i].style.border = "#000000 solid 1px";
                    inputs[i].disabled = true;
                    inputs[i].style.backgroundColor = "#dddddd"
                    console.log(inputs[i].value); // seleciona todas as input com a class do inputs
                }

            });
        } else {
            throw ('Houve um erro na API!');
        }
    }).catch(function (resposta) {
        console.error(resposta);
    });



</script>