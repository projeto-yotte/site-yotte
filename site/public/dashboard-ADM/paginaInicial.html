<!DOCTYPE html>
<html lang="BR-PT">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.8/css/line.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../css/visaoGeral.css">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Icons -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.2.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/paginaInicial.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../js/cadastroADM.js"></script>
    <script src="../js/logins.js"></script>
    <title>Página Inicial</title>
</head>

<body>
    <!-- PAG MENU -->
    <div class="container">

        <div class="lateral">
            <!-- parte de cima -->
            <div class="listaBaixo">
                <div class="navegacão">

                    <div class="navHeader">
                        <img src="../assets/img/logo.png">
                    </div>
                    <ul>
                        <li class="lista destaque">
                            <a href="">
                                <i class="uil uil-create-dashboard destaque"></i>
                                <span class="lista">Página inical</span>
                            </a>
                        </li>
                        <!-- <li class="lista ">
                            <a href="VisaoGeral.html">
                                <i class="bi bi-graph-up "></i>
                                <i class="bi bi-bar-chart"></i>
                                <span class="lista">Geral</span>
                            </a>
                        </li> -->
                        <li class="lista">
                            <a href="cadastrarUser.html">
                                <i class="bi bi-person-plus-fill"></i>
                                <!-- <i class="bi bi-file-earmark-text"></i> -->
                                <span class="lista">Usuários</span>
                            </a>
                        </li>
                        <li class="lista">
                            <a href="telaLogs.html">
                                <i class="bi bi-clock-history"></i>
                                <!-- <i class="bi bi-gear"></i> -->
                                <span class="lista">Tela de Logs</span>
                            </a>
                        </li>
                        <li class="lista">
                            <a onclick="encerrarSession()">
                                <i class="bi bi-box-arrow-right"></i>
                                <!-- <i class="bi bi-gear"></i> -->
                                <span class="lista" onclick="encerrarSession()">Sair</span>
                            </a>
                        </li>
                    </ul>
                </div>

            </div>

        </div>
        <!-- FIM DO MENU -->

        <div class="areaDash">

            <div class="topDash">
                <span>Página Inicial</span>
                <div class="nomeNome">
                    <a href="../login.html">
                        <!-- <i class="uil uil-signout"></i> -->
                    </a>

                    <ul class="ul2">
                        <span class="loginUsuario" id="loginUsuario">Nome</span>
                    </ul>
                </div>

            </div>

            <div class="chats-group">
                <div class="container-chart">
                    <span>Usuários Ativos e Inativos</span>
                    <div class="chart">
                        <canvas id="myChart"></canvas>
                    </div>
                </div>

                <div class="KPI">
                    <div class="containerKpi" id="caixaForaEspediente">
                        <span>Colaboradores fora do espediente</span>
                        <div class="caixa">
                            <span class="info" id="nomeMaquina">Maquina YH - 62023</span>
                            <span class="span">Visto por ultimo: <span class="info destaque" id="hora_captura"> h/
                                    ultima captura</span></span>
                            <span class="span">Horas fora do expediente <span class="info destaque" id="hora_captura">
                                    h/</span></span>
                        </div>
                        <div class="caixa">
                            <span class="info" id="nomeMaquina">Maquina YH - 72124
                            </span>
                            <span class="span">Visto por ultimo: <span class="info destaque" id="hora_captura"> h/
                                    ultima captura</span></span>
                            <span class="span">Horas fora do expediente <span class="info destaque" id="hora_captura">
                                    h/</span></span>
                        </div>
                        <div class="caixa">
                            <span class="info" id="nomeMaquina">Maquina YH - 82225
                            </span>
                            <span class="span">Visto por ultimo: <span class="info destaque" id="hora_captura"> h/
                                    ultima captura</span></span>
                            <span class="span">Horas fora do expediente <span class="info destaque" id="hora_captura">
                                    h/</span></span>
                        </div>
                        <div class="caixa">
                            <span class="info" id="nomeMaquina">Maquina YH - 92326
                            </span>
                            <span class="span">Visto por ultimo: <span class="info destaque" id="hora_captura"> h/
                                    ultima captura</span></span>
                            <span class="span">Horas fora do expediente <span class="info destaque" id="hora_captura">
                                    h/ ultima captura</span></span>
                        </div>
                    </div>

                    <!-- <div class="containerKpi2">
                        <span>Janelas usuários</span>
                        <span>Goolgle <span id="infoCpu">10% CPU</span><span id="infoRam"> 2% RAM</span></span>
                        <span id="qtdProcessos" class="qtdProcessos">10 <span
                                class="qtdProcessos">processos</span></span>
                        <span>Goolgle <span id="infoCpu">10% CPU</span><span id="infoRam"> 2% RAM</span></span>
                        <span id="qtdProcessos" class="qtdProcessos">10 <span
                                class="qtdProcessos">processos</span></span>
                    </div> -->
                </div>

                <div class="containerBarHorizont">
                    <div class="containerGraphi">
                        <span>Relatório de problemas</span>
                        <span class="littleInfo">De acordo com hardware</span>
                        <div class="chart2">
                            <canvas id="myChart2"></canvas>
                        </div>
                    </div>

                    <!--Alertas-->

                    <div class="toast-stack" id="toast-stack">
                        <!-- <div class="toast">
                            <div class="warning">
                                <div class="toast-icon">
                                    <i class="ri-alert-fill"></i>
                                </div>
                                <div class="Corpo_alerta">
                                    <span>Colaborador: <span id="nome_funcionario"></span></span>
                                    <span>Ip Maquina: <span id="ip_maquina"></span></span>
                                    <span>Alerta: <span id="descricao"></span></span>
                                </div>
                                <button class="close">
                                    <i class="ri-close-fill"></i>
                                </button>
                            </div>
                            <div class="timer">

                            </div>
                        </div> -->
                    </div>
                </div>
            </div>
            <div class="toast-stack"></div>
            <div class="chart-bottom">
                <!-- <div class="listaMaquinas">
                    <Span class="titleMaquina">Lista de Máquinas Cadastradas</Span>
                    <a href="dashEspecifica.html">
                        <div class="containerColTittle">
                            <span>Hostname: <span id="idMaquina">Maquina YH - 62023</span></span>
                            <span id="regiao">SP, Brasil</span>
                        </div>
                    </a> -->
                <!-- PRÓXIMA DIV ESTÁ SENDO PREENCHIDA PELO BANCO -->
                <div class="listaMaquinas">
                    <Span class="titleMaquina">Lista de Máquinas Cadastradas</Span>
                    <div class="topLista">
                        <span class="fontRed">Nome do Funcionário</span>
                        <span class="fontRed">Ip</span>
                    </div>
                    <div id="listaMaquinas" class="infoLista"></div>
                </div>
                <div class="containerBarHorizontal">
                    <div class="containerGraphi2">
                        <span>Tempo de inatividade<span class="littleInfo">(últimos 7 dias)</span></span>

                        <span class="littleInfo">Em horas</span>
                        <div class="chart1">
                            <canvas id="myChart3"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    </div>

</body>

</html>

<script>
    const ctxx = document.getElementById('myChart2');

    window.addEventListener("load", () => {
        listarMaquinas(sessionStorage.ID_USUARIO);
        obterDadosGraficoInativos();
        foraDoEspediente(sessionStorage.ID_USUARIO);
        obterDadosGrafico();
        buscarAlertas(sessionStorage.ID_USUARIO);
        plotarDadosAdmin();
    });

    function plotarDadosAdmin() {
        const spanNomeAdmin = document.getElementById("loginUsuario");
        spanNomeAdmin.textContent = sessionStorage.NOME_ADMIN;
    }


    function listarMaquinas(id_admin) {
        fetch(`/maquina/maquinas/${sessionStorage.ID_USUARIO}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Erro ao buscar máquinas');
        }).then(function (maquinas) {

            const maquinasContainer = document.getElementById('listaMaquinas');

            // Limpa o conteúdo antes de adicionar as máquinas
            maquinasContainer.innerHTML = '';

            maquinas.forEach(maquina => {
                console.log("maquina: " + maquina.nome_usuario);

                const maquinaElement = document.createElement('div');
                maquinaElement.innerHTML = `
                    <div onclick="passarIdFuncionario(${maquina.id_funcionario})">
                        <div class="containerColTittle">
                            <span id="${maquina.id_funcionario}">${maquina.funcionario}</span>
                            <span id="${maquina.id_maquina}">${maquina.ip}</span>
                        </div>
                    </div>
                `;

                maquinasContainer.appendChild(maquinaElement); // Adiciona a maquinaElement ao container de maquinas
            });
        }).catch(function (error) {
            console.error('Erro ao buscar máquinas:', error);
        });
    }


    function passarIdFuncionario(idFuncionario) {
        sessionStorage.removeItem('ID_FUNCIONARIO');
        sessionStorage.setItem('ID_FUNCIONARIO', idFuncionario);

        setTimeout(function () {
            window.location = './dashEspecifica.html'

        }, 1000); // apenas para exibir o loading
    }

</script>



<script>

    // OBTER DADOS DO GRAFICO DE PIZZA ================
    function obterDadosGraficoInativos(id_empresa) {

        fetch(`/dashInicial/ativosInativos/${sessionStorage.ID_EMPRESA}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    plotarGraficoNativosInativos(resposta, id_empresa);

                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    // PLOTAR DADOS DO GRAFICO DE PIZZA ================

    function plotarGraficoNativosInativos(resposta, id_empresa) {
        console.log(JSON.stringify(resposta))
        console.log('iniciando plotagem do gráfico...');

        let labels = [];
        // Criando estrutura para plotar gráfico - dados
        let dados = {
            labels: ['Ativos', 'Inativos'],
            datasets: [{
                label: [],
                data: [],
                fill: false,
                borderColor: 'black',
                backgroundColor: ['rgba(227, 40, 50)', 'rgba(128, 128, 128)'],
                tension: 0.1
            }]
        };

        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            dados.datasets[0].data.push(registro.count_ligadas);
            dados.datasets[0].data.push(registro.count_desligadas);
            console.log(resposta)
        }

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        // Criando estrutura para plotar gráfico - config
        const config = {
            type: 'pie',
            data: dados,
            options: {
                scales: {
                    y: {
                        reverse: true, // Inverte a direção do eixo X
                        beginAtZero: true
                    }
                }
            }
        };

        // Adicionando gráfico criado em div na tela
        let myChart = new Chart(
            document.getElementById(`myChart`),
            config
        );

        setTimeout(() => atualizarGraficoNativosInativos(id_empresa, dados, myChart), 2000);
    }


    // Esta função *atualizarGrafico* atualiza o gráfico que foi renderizado na página,
    // buscando a última medida inserida em tabela contendo as capturas, 

    //     Se quiser alterar a busca, ajuste as regras de negócio em src/controllers
    //     Para ajustar o "select", ajuste o comando sql em src/models


    function atualizarGraficoNativosInativos(id_empresa, dados, myChart) {
        fetch(`/dashInicial/ativosInativos/${sessionStorage.ID_EMPRESA}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (novoRegistro) {

                    // alertar(novoRegistro, id_empresa);
                    console.log(`Dados recebidos: ${JSON.stringify(novoRegistro)}`);
                    console.log(`Dados atuais do gráfico:`);
                    console.log(dados);


                    for (i = 0; i < novoRegistro.length; i++) {
                        var registro = novoRegistro[i];
                        // tirando e colocando valores no gráfico

                        dados.datasets[0].data.shift();  // apagar o primeiro de umidade
                        dados.datasets[0].data.push(registro.count_ligadas); // incluir uma nova medida de umidade

                        dados.datasets[0].data.shift();
                        dados.datasets[0].data.push(registro.count_desligadas);
                    }

                    myChart.update();


                    // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                    proximaAtualizacao = setTimeout(() => atualizarGraficoNativosInativos(id_empresa, dados, myChart), 5000);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
                // Altere aqui o valor em ms se quiser que o gráfico atualize mais rápido ou mais devagar
                proximaAtualizacao = setTimeout(() => atualizarGraficoNativosInativos(id_empresa, dados, myChart), 5000);
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }
</script>

<script>

    function foraDoEspediente(id_admin) {
        fetch(`/dashInicial/foraDoEspediente/${id_admin}`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
            },
        })
            .then(function (response) {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('Erro ao buscar maquinas');
            })
            .then(function (maquinas) {
                console.log(maquinas);
                const maquinasContainer = document.getElementById('caixaForaEspediente');

                maquinasContainer.innerHTML = ''; // Limpa o conteúdo antes de adicionar as máquinas
                maquinasContainer.innerHTML = '<span> Colaboradores Fora Do Expediente </span>';

                maquinas.forEach(maquina => {
                    const maquinaElement = document.createElement('div');
                    maquinaElement.classList.add('caixaForaEspediente');

                    // Formatando a data
                    const ultimaCaptura = new Date(maquina.ultima_captura_dia);
                    const formattedDate = `${ultimaCaptura.getDate()}/${ultimaCaptura.getMonth() + 1}/${ultimaCaptura.getFullYear()}`;
                    const formattedTime = `${ultimaCaptura.getHours()}:${ultimaCaptura.getMinutes()}`;

                    // Convertendo minutos para horas
                    const tempoForaExpedienteHoras = Math.floor(maquina.tempo_fora_expediente_minutos / 60);
                    const tempoForaExpedienteMinutos = maquina.tempo_fora_expediente_minutos % 60;

                    maquinaElement.innerHTML = `
                    <div class="caixa">
                        <span class="info" id="nomeMaquina">${maquina.nome_usuario} - ${maquina.id_maquina}</span>
                        <span class="span">Visto por ultimo: <span class="info destaque" id="hora_captura">${formattedDate} ${formattedTime}</span></span>
                        <span class="span">Horas fora do expediente <span class="info destaque" id="hora_captura">${tempoForaExpedienteHoras}h ${tempoForaExpedienteMinutos}min</span></span>
                    </div>
                `;

                    maquinasContainer.appendChild(maquinaElement); // Adiciona a maquinaElement ao container de maquinas
                });
            })
            .catch(function (error) {
                console.error('Erro:', error);
            });
    }

</script>

<script>
    // Exemplo de comentários explicativos no script JavaScript

    // Exibe o ID_EMPRESA armazenado na sessionStorage no console
    console.log(sessionStorage.ID_EMPRESA);
    console.log('Iniciando plotagem do gráfico...');

    // Função para obter dados do gráfico
    function obterDadosGrafico(id_empresa) {
        // Requisição para obter dados do relatório de problemas
        fetch(`/dashInicial/relatorioProblemasUltimas/${sessionStorage.ID_EMPRESA}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    // Processa os dados recebidos e chama a função para plotar o gráfico de problemas
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        resposta.reverse();
                        plotarGraficoProblemas(resposta, id_empresa);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });

        // Requisição para obter dados do gráfico de tempo de inatividade
        fetch(`/dashInicial/tempoInatividadeUltimas/${sessionStorage.ID_EMPRESA}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    // Processa os dados recebidos e chama a função para plotar o gráfico de tempo de inatividade
                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        plotarGraficoInatividade(resposta, id_empresa);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    // Função para plotar o gráfico de tempo de inatividade
    function plotarGraficoInatividade(resposta, id_empresa) {
        console.log('Iniciando plotagem do gráfico...');

        let labels = ['Máquina'];

        let dados = {
            labels: labels,
            datasets: [
                {
                    label: 'Máquina 01',
                    data: [],
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(227, 40, 50)',
                    tension: 0.1
                },
                {
                    label: 'Máquina 02',
                    data: [],
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(146, 19, 26)',
                    tension: 0.1
                },
                {
                    label: 'Máquina 03',
                    data: [],
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(78, 10, 14)',
                    tension: 0.1
                }
            ]
        };

        // Preenche os dados com valores recebidos
        for (let i = 0; i < resposta.length; i++) {
            let registro = resposta[i];
            dados.datasets[i].data.shift();
            dados.datasets[i].data.push(registro.tempo_inatividade_horas);
        }

        // Configuração do gráfico
        const config = {
            type: 'bar',
            data: dados,
            options: {
                scales: {
                    y: {
                        reverse: true,
                        beginAtZero: true
                    }
                }
            }
        };

        // Criação do gráfico
        let myChart = new Chart(document.getElementById('myChart3'), config);
        setTimeout(() => atualizarGraficoInatividade(id_empresa, dados, myChart), 3000);
    }

    // Função para atualizar o gráfico de tempo de inatividade
    function atualizarGraficoInatividade(id_empresa, dados, myChart) {
        fetch(`/dashInicial/tempoInatividadeUltimas/${sessionStorage.ID_EMPRESA}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (novoRegistro) {
                        console.log(`GRAFICO DE INATIVIDADE: ${JSON.stringify(novoRegistro)}`);
                        console.log('Dados atuais do gráfico:');
                        console.log(dados);

                        for (let i = 0; i < novoRegistro.length; i++) {
                            let registro = novoRegistro[i];
                            dados.datasets[i].data.shift();
                            dados.datasets[i].data.push(registro.tempo_inatividade_horas);
                        }

                        myChart.update();

                        // Define o próximo intervalo de atualização
                        proximaAtualizacao = setTimeout(() => atualizarGraficoInatividade(id_empresa, dados, myChart), 5000);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                    // Define o próximo intervalo de atualização em caso de erro
                    proximaAtualizacao = setTimeout(() => atualizarGraficoInatividade(id_empresa, dados, myChart), 5000);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    // Função para plotar o gráfico de problemas
    function plotarGraficoProblemas(resposta, id_empresa) {
        console.log('Iniciando plotagem do gráfico...');

        let labels = ['Componentes'];

        let dados = {
            labels: labels,
            datasets: [
                {
                    label: 'CPU',
                    data: [],
                    fill: false,
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(227, 40, 50, 0.8)',
                    tension: 0.1
                },
                {
                    label: 'RAM',
                    data: [],
                    fill: false,
                    borderColor: 'rgb(199, 52, 52)',
                    backgroundColor: 'rgba(227, 40, 50, 0.8)',
                    tension: 0.1
                },
                {
                    label: 'DISCO',
                    data: [],
                    fill: false,
                    borderColor: 'rgb(199, 52, 52)',
                    backgroundColor: 'rgba(227, 40, 50, 0.8)',
                    tension: 0.1
                }
            ]
        };

        // Preenche os dados com valores recebidos
        for (let i = 0; i < resposta.length; i++) {
            let registro = resposta[i];
            dados.datasets[0].data.shift(registro.total_alerta_cpu);
            dados.datasets[0].data.push(registro.total_alerta_cpu);
            dados.datasets[1].data.shift(registro.total_alerta_ram);
            dados.datasets[1].data.push(registro.total_alerta_ram);
            dados.datasets[2].data.shift(registro.total_alerta_disco);
            dados.datasets[2].data.push(registro.total_alerta_disco);
        }

        // Configuração do gráfico
        const config = {
            type: 'bar',
            data: dados,
        };

        // Criação do gráfico
        let myChart = new Chart(document.getElementById('myChart2'), config);
        setTimeout(() => atualizarGraficoRelatorioProblemas(id_empresa, dados, myChart), 2000);
    }

    // Função para atualizar o gráfico de problemas
    function atualizarGraficoRelatorioProblemas(id_empresa, dados, myChart) {
        fetch(`/dashInicial/relatorioProblemasUltimas/${sessionStorage.ID_EMPRESA}`, { cache: 'no-store' })
            .then(function (response) {
                if (response.ok) {
                    response.json().then(function (novoRegistro) {
                        console.log(`Relatório Problemas: ${JSON.stringify(novoRegistro)}`);
                        console.log('Dados atuais do gráfico:');
                        console.log(dados);

                        dados.datasets[0].data.shift();
                        dados.datasets[0].data.push(novoRegistro[0].total_alerta_cpu);

                        dados.datasets[1].data.shift();
                        dados.datasets[1].data.push(novoRegistro[0].total_alerta_ram);

                        dados.datasets[2].data.shift();
                        dados.datasets[2].data.push(novoRegistro[0].total_alerta_disco);

                        myChart.update();

                        // Define o próximo intervalo de atualização
                        proximaAtualizacao = setTimeout(() => atualizarGraficoRelatorioProblemas(id_empresa, dados, myChart), 5000);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                    // Define o próximo intervalo de atualização em caso de erro
                    proximaAtualizacao = setTimeout(() => atualizarGraficoRelatorioProblemas(id_empresa, dados, myChart), 5000);
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }



    // SCRIPT ALERTAS

    const divToastStack = document.getElementById('toast-stack');

    function removeToast(id) {
        const divToast = document.getElementById(`id-toast${id}`);
        divToast.remove();
    }

    // divToastStack.style.display = 'none';
    var id_admin = sessionStorage.ID_USUARIO;
    var id_empresa = sessionStorage.ID_EMPRESA;

    function buscarAlertas(id_admin, id_empresa) {
        fetch(`/alertas/listar/${sessionStorage.ID_USUARIO}/${sessionStorage.ID_EMPRESA}`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(function (resposta) {
                if (resposta.ok) {
                    console.log(JSON.stringify(resposta))
                    return resposta.json();
                }
                throw new Error('Erro ao buscar alertas');
            })
            .then(function (alertas) {

                console.log(JSON.stringify(alertas));


                var listaId = [];

                console.log(listaId)

                alertas.forEach(alerta => {
                    if (!listaId.includes(alerta.id_alerta)) {
                        plotar();
                    }
                    console.log("alerta:" + JSON.stringify(alerta))

                    divToastStack.children

                    function plotar() {
                        divToastStack.innerHTML += `
                        
                                <div class="toast" id='id-toast${alerta.id_alerta}'>
                                    <div class="warning">
                                        <div class="toast-icon">
                                            <i class="ri-alert-fill"></i>
                                        </div>
                                        <div class="Corpo_alerta">
                            <span>Colaborador: <span id="nome_funcionario">${alerta.nome}</span></span>
                            <span>Ip Maquina: <span id="ip_maquina">${alerta.ip}</span></span>
                            <span>Alerta: <span id="descricao">${alerta.descricao}</span></span>
                            </div>
                                        <button onclick="removeToast(${alerta.id_alerta})" class="close">
                                            <i class="ri-close-fill"></i>
                                        </button>
                                    </div>
                                    <div class="timer">
            
                                    </div>
                                </div>
                        `;

                        listaId.push(alerta.id_alerta);
                    }





                    console.log(alerta.nome)

                    setTimeout(() => {
                        divToastStack.remove();
                    }, 5000);
                });
            })


            .catch(function (error) {
                console.error('Erro: ', error);
            });

        setInterval(buscarAlertas, 100000);




    }

</script>